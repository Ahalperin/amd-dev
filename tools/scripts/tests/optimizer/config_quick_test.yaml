# RCCL Parameter Optimization Configuration - QUICK TEST VERSION
# Reduced iterations and message sizes for fast testing

# Test Configuration
test_config:
  test_name: "all_reduce_perf"
  
  # REDUCED for quick testing
  minbytes: "1M"        # Smaller message size
  maxbytes: "1M"        # Smaller message size
  stepfactor: 2
  gpus_per_rank: 1
  iterations: 5         # Reduced from 20
  warmup_iters: 1       # Reduced from 5
  check_iters: 1
  
  # MPI configuration
  mpi_hosts: "172.30.160.145:8,172.30.160.150:8"
  num_processes: 16
  bind_to: "numa"
  
  # Network interface configuration
  oob_tcp_if: "enp81s0f1np1"
  btl_tcp_if: "enp81s0f1np1"
  
  # Timeout for each test run (seconds)
  timeout: 120  # Shorter timeout for quick tests

# Fixed Environment Variables (always set, not optimized)
fixed_env_vars:
  # Path configuration
  PATH: "/usr/local/bin:/opt/rocm/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin"
  LD_LIBRARY_PATH: "/home/dn/amd-dev/amd/rccl/build/release:/home/dn/amd-dev/amd/amd-anp/build:/usr/local/lib:"
  LD_PRELOAD: "/home/dn/amd-dev/amd/amd-anp/build/librccl-net.so:/home/dn/amd-dev/amd/rccl/build/release/librccl.so"
  
  # Network configuration
  NCCL_SOCKET_IFNAME: "enp81s0f1np1"
  NCCL_IB_HCA: "ionic_0:1,ionic_1:1,ionic_2:1,ionic_3:1,ionic_4:1,ionic_5:1,ionic_6:1,ionic_7:1"
  NCCL_IB_GID_INDEX: 1
  
  # Debug/logging (VERSION for less output)
  NCCL_DEBUG: "VERSION"
  
  # Other fixed settings
  HSA_NO_SCRATCH_RECLAIM: 1
  NCCL_IGNORE_CPU_AFFINITY: 1
  NCCL_GDRCOPY_ENABLE: 0
  NCCL_DMABUF_ENABLE: 0
  IONIC_LOCKFREE: "all"

# Parameters to Optimize - REDUCED FOR QUICK TESTING
optimize_params:
  
  # Just 2 parameters for quick test
  NCCL_IB_QPS_PER_CONNECTION:
    type: "categorical"
    values: [1, 4]  # Just 2 values instead of 4
    description: "Number of QPs per IB connection"
  
  RCCL_LL128_FORCE_ENABLE:
    type: "categorical"
    values: [0, 1]
    description: "Force enable LL128 protocol"

# Optimization Settings
optimization:
  method: "random"  # Use random for quick test
  max_iterations: 5  # Just 5 iterations
  n_initial_points: 3
  objective: "busbw_oop"
  direction: "maximize"
  validation_runs: 2  # Reduced validation
  early_stopping_patience: 10

# Output Configuration
output:
  database: "rccl_optimization_results.db"
  output_dir: "optimization_runs"
  save_logs: true
  verbosity: 2  # INCREASED verbosity for debugging


